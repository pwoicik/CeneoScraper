{% extends "layout.html" %}

{% block content %}
    <script src="{{ url_for("static", filename="action_buttons.js") }}"></script>
    <script src="{{ url_for("static", filename="product.js") }}"></script>

    <div id="product">

        <section class="product-info">
            <div>
                <div class="product-image">
                    <img src="{{ product.img_url }}" alt="zdjęcie produktu">
                </div>

                <h2>{{ product.name }}</h2>

                <h4 class="product-score">
                    {% if product.score %}
                        <span>ocena:</span> {{ product.score }} / 5 <span
                    >(na {{ product.reviews|length }} {% if product.reviews|length == 1 %}
                        opinię{% else %}opinii{% endif %})
                </span>
                    {% else %}
                        Produkt bez oceny
                    {% endif %}
                </h4>

                <div class="actions">
                    {% include "components/action_buttons.html" %}
                </div>
            </div>
        </section>

        <section id="charts">
            <iframe id="score-chart" srcdoc="{{ score_chart }}"></iframe>
            <iframe id="recommendations-chart" srcdoc="{{ recommendations_chart }}"></iframe>
        </section>

        <div id="table-header">
            <h3>Opinie:</h3>
            <button id="filter-button">Filtruj</button>
        </div>
        <table>
            <thead>
            <tr>
                <th>
                    <button
                            class="sort-button"
                            data-attr="author"
                            data-curr="{% if request.args["sort-by"] != "author" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Autor
                    </button>
                </th>
                <th>
                    <button
                            class="sort-button"
                            data-attr="is_recommending"
                            data-curr="{% if request.args["sort-by"] != "is_recommending" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Rekomendacja
                    </button>
                </th>
                <th>
                    <button
                            class="sort-button"
                            data-attr="score"
                            data-curr="{% if request.args["sort-by"] != "score" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Ocena
                    </button>
                </th>
                <th>
                    <button
                            class="sort-button"
                            data-attr="is_purchase_confirmed"
                            data-curr="{% if request.args["sort-by"] != "is_purchase_confirmed" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Potwierdzona zakupem
                    </button>
                </th>
                <th>
                    <button
                            class="sort-button"
                            data-attr="issue_date"
                            data-curr="{% if request.args["sort-by"] != "issue_date" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Wystawiona
                    </button>
                </th>
                <th>
                    <button
                            class="sort-button"
                            data-attr="purchase_date"
                            data-curr="{% if request.args["sort-by"] != "purchase_date" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Zakupiono
                    </button>
                </th>
                <th>
                    <button
                            class="sort-button"
                            data-attr="yes_votes"
                            data-curr="{% if request.args["sort-by"] != "yes_votes" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Głosy pozytywne
                    </button>
                </th>
                <th>
                    <button
                            class="sort-button"
                            data-attr="no_votes"
                            data-curr="{% if request.args["sort-by"] != "no_votes" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Głosy negatywne
                    </button>
                </th>
                <th>
                    <button
                            class="sort-button"
                            data-attr="content"
                            data-curr="{% if request.args["sort-by"] != "content" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Treść
                    </button>
                </th>
                <th>
                    <button
                            class="sort-button"
                            data-attr="pros"
                            data-curr="{% if request.args["sort-by"] != "pros" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Zalety
                    </button>
                </th>
                <th>
                    <button
                            class="sort-button"
                            data-attr="cons"
                            data-curr="{% if request.args["sort-by"] != "cons" %}n{% elif "reversed" in  request.args %}r{% else %}y{% endif %}"
                    >
                        Wady
                    </button>
                </th>
            </tr>
            </thead>
            <tbody>
            {% for review in product.reviews %}
                <tr id="{{ review.id }}">
                    <td>{{ review.author }}</td>
                    <td class="correct-icon center">
                        {% with bool = review.is_recommending %}
                            {% include "components/correct_icon.html" %}
                        {% endwith %}
                    </td>
                    <td class="center">{{ review.score }} / 5</td>
                    <td class="correct-icon center">
                        {% with bool = review.is_purchase_confirmed %}
                            {% include "components/correct_icon.html" %}
                        {% endwith %}
                    </td>
                    <td class="center no-wrap">{{ review.issue_date.date() }}</td>
                    <td class="center no-wrap">
                        {% if review.purchase_date %}
                            {{ review.purchase_date.date() }}
                        {% else %}
                            ———
                        {% endif %}
                    </td>
                    <td class="center">{{ review.yes_votes }}</td>
                    <td class="center">{{ review.no_votes }}</td>
                    <td>{{ review.content }}</td>
                    <td>
                        <ul class="pros-list">
                            {% for pro in review.pros %}
                                <li>{{ pro }}</li>
                            {% endfor %}
                        </ul>
                    </td>
                    <td>
                        <ul class="cons-list">
                            {% for con in review.cons %}
                                <li>{{ con }}</li>
                            {% endfor %}
                        </ul>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

        <div id="filters">
            <button id="close-filters-button">
                {% include "components/delete_icon.html" %}
            </button>

            <form>
                <label for="filter-author-input">Autorzy</label>
                <input
                        id="filter-author-input"
                        type="text"
                        placeholder="lista autorów rozdzielonych przecinkami"/>

                <label for="recommendation-input">Rekomendacja</label>
                <div id="recommendation-input" class="radios-container">
                    <div class="radio">
                        <input id="rec-no" type="radio" name="recommendation-radio" value="f"/>
                        <label for="rec-no">Tylko bez</label>
                    </div>
                    <div class="radio">
                        <input id="rec-none" type="radio" name="recommendation-radio" value="" checked/>
                        <label for="rec-none">Wszystkie</label>
                    </div>
                    <div class="radio">
                        <input id="rec-yes" type="radio" name="recommendation-radio" value="t"/>
                        <label for="rec-yes">Tylko z</label>
                    </div>
                </div>

                <label for="score-slider">Ocena</label>
                {% with ss_id = "score-slider", range = [0, 5], step = 0.5 %}
                    {% include "components/double_range_slider.html" %}
                {% endwith %}

                <label for="purchase-confirmed-input">Potwierdzona zakupem</label>
                <div id="purchase-confirmed-input" class="radios-container">
                    <div class="radio">
                        <input id="pc-no" type="radio" name="pc-conf-radio" value="f"/>
                        <label for="pc-no">Tylko bez</label>
                    </div>
                    <div class="radio">
                        <input id="pc-none" type="radio" name="pc-conf-radio" value="" checked/>
                        <label for="pc-none">Wszystkie</label>
                    </div>
                    <div class="radio">
                        <input id="pc-yes" type="radio" name="pc-conf-radio" value="t"/>
                        <label for="pc-yes">Tylko z</label>
                    </div>
                </div>

                <label for="issue-date-input">Data wystawienia</label>
                <div id="issue-date-input" class="double-text-input-container">
                    <label for="issue-date-from">od</label>
                    <input id="issue-date-from" type="date"> - <input id="issue-date-to" type="date">
                    <label for="issue-date-to">do</label>
                </div>

                <label for="purchase-date-input">Data zakupu</label>
                <div id="purchase-date-input" class="double-text-input-container">
                    <label for="purchase-date-from">od</label>
                    <input id="purchase-date-from" type="date"> - <input id="purchase-date-to" type="date">
                    <label for="purchase-date-to">do</label>
                </div>

                <label for="yes-votes-input">Głosy pozytywne</label>
                <div id="yes-votes-input" class="double-text-input-container">
                    <label for="yes-votes-from">od</label>
                    <input
                        id="yes-votes-from"
                        type="number"
                        placeholder="Min"
                    > - <input
                        id="yes-votes-to"
                        type="number"
                        placeholder="Max"
                    >
                    <label for="yes-votes-to">do</label>
                </div>

                <label for="no-votes-input">Głosy pozytywne</label>
                <div id="no-votes-input" class="double-text-input-container">
                    <label for="no-votes-from">od</label>
                    <input
                        id="no-votes-from"
                        type="number"
                        placeholder="Min"
                    > - <input
                        id="no-votes-to"
                        type="number"
                        placeholder="Max"
                    >
                    <label for="no-votes-to">do</label>
                </div>

                <label for="content-input">Treść</label>
                <div id="content-input" class="radios-container">
                    <div class="radio">
                        <input id="content-no" type="radio" name="content-radio" value="f"/>
                        <label for="content-no">Tylko bez</label>
                    </div>
                    <div class="radio">
                        <input id="content-none" type="radio" name="content-radio" value="" checked/>
                        <label for="content-none">Wszystkie</label>
                    </div>
                    <div class="radio">
                        <input id="content-yes" type="radio" name="content-radio" value="t"/>
                        <label for="content-yes">Tylko z</label>
                    </div>
                </div>

                <label for="pros-input">Zalety</label>
                <div id="pros-input" class="radios-container">
                    <div class="radio">
                        <input id="pros-no" type="radio" name="pros-radio" value="f"/>
                        <label for="pros-no">Tylko bez</label>
                    </div>
                    <div class="radio">
                        <input id="pros-none" type="radio" name="pros-radio" value="" checked/>
                        <label for="pros-none">Wszystkie</label>
                    </div>
                    <div class="radio">
                        <input id="pros-yes" type="radio" name="pros-radio" value="t"/>
                        <label for="pros-yes">Tylko z</label>
                    </div>
                </div>

                <label for="cons-input">Wady</label>
                <div id="cons-input" class="radios-container">
                    <div class="radio">
                        <input id="cons-no" type="radio" name="cons-radio" value="f"/>
                        <label for="cons-no">Tylko bez</label>
                    </div>
                    <div class="radio">
                        <input id="cons-none" type="radio" name="cons-radio" value="" checked/>
                        <label for="cons-none">Wszystkie</label>
                    </div>
                    <div class="radio">
                        <input id="cons-yes" type="radio" name="cons-radio" value="t"/>
                        <label for="cons-yes">Tylko z</label>
                    </div>
                </div>

                <button>Zastosuj</button>
            </form>
        </div>
    </div>
{% endblock %}
